:root {
  --bg-main: #eef3ff;
  --bg-navbar: #ffffff;
  --bg-panel: #f6f9ff;
  --bg-hover: #eef4ff;

  --primary: #1e5eff;
  --secondary: #5e8dff;
  --accent: #4f46e5;

  --text-main: #1d2840;
  --text-muted: #5a6785;

  --border-color: rgba(30, 94, 255, 0.24);
  --ring-color: rgba(30, 94, 255, 0.45);
  --glow-cyan: 0 0 10px rgba(30, 94, 255, 0.25);
  --glow-magenta: 0 0 10px rgba(79, 70, 229, 0.22);
  --glow-soft: 0 0 0 1px rgba(30, 94, 255, 0.1), 0 8px 20px rgba(21, 33, 66, 0.12);
  --glow-strong: 0 0 0 1px rgba(79, 70, 229, 0.14), 0 12px 26px rgba(21, 33, 66, 0.18);

  /* Mapping vers l'architecture existante */
  --bg: var(--bg-main);
  --surface: var(--bg-navbar);
  --surface-alt: var(--bg-panel);
  --surface-elevated: var(--bg-hover);
  --text: var(--text-main);
  --muted: var(--text-muted);
  --primary-strong: #1c48ba;
  --on-primary: #ffffff;
  --border: var(--border-color);
  --overlay: rgba(15, 23, 42, 0.42);
  --shadow-soft: 0 8px 20px rgba(21, 33, 66, 0.1);
  --shadow-strong: 0 16px 34px rgba(21, 33, 66, 0.2);
}body {
  background: radial-gradient(circle at top right, #ffffff, var(--bg-main) 72%);
  color: var(--text-main);
}

.ambient-bg {
  background:
    radial-gradient(circle at 78% 12%, rgba(30, 94, 255, 0.1), transparent 36%),
    radial-gradient(circle at 20% 82%, rgba(79, 70, 229, 0.1), transparent 36%),
    radial-gradient(circle at 50% 14%, rgba(94, 141, 255, 0.08), transparent 32%),
    var(--bg-main);
}

.navbar {
  background: linear-gradient(90deg, var(--bg-navbar), var(--bg-panel));
  border-bottom: 1px solid var(--border-color);
  box-shadow: var(--glow-soft);
}

.nav-menu li .nav-btn,
.brand-text,
.brand-subtext {
  color: var(--text-main);
  transition: 0.3s ease;
}

.nav-menu li .nav-btn:hover,
.dropdown.open .nav-btn {
  color: var(--primary);
  text-shadow: none;
  box-shadow: inset 0 0 0 1px rgba(30, 94, 255, 0.24);
}

.sidebar-left,
.sidebar-right,
.panel-left,
.panel-right,
.panel {
  background: var(--bg-panel);
  border-right: 1px solid var(--border-color);
}

.panel-header {
  background: linear-gradient(90deg, var(--bg-navbar), var(--bg-panel));
  border-bottom: 1px solid var(--border-color);
}

button,
.btn,
.icon-btn,
.menu-action,
.nav-btn,
.quick-btn,
.fab-item {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border: none;
  color: var(--on-primary);
  box-shadow: var(--glow-soft);
}

button:hover,
.btn:hover,
.icon-btn:hover,
.menu-action:hover,
.nav-btn:hover,
.quick-btn:hover,
.fab-item:hover {
  box-shadow: var(--glow-cyan);
}

.fab-button {
  background: linear-gradient(135deg, var(--accent), var(--secondary));
  box-shadow: var(--glow-magenta);
  color: var(--on-primary);
}

.fab-button:hover {
  box-shadow: 0 0 18px rgba(255, 0, 200, 0.75);
}

.dropdown-menu,
.mobile-menu,
.fab-menu,
.modal-content,
.dashboard,
.install-toast,
.toast,
.data-quick-bar {
  background: var(--surface);
  border: 1px solid var(--border-color);
}

.dropdown-menu li:hover,
.dropdown-menu .menu-action:hover,
.mobile-menu .menu-action:hover,
.fab-menu .menu-action:hover,
.fab-menu .fab-item:hover {
  background: var(--bg-hover);
}

.mobile-bottom-bar,
.bottom-bar {
  background: linear-gradient(90deg, var(--bg-navbar), var(--bg-panel));
  border-top: 1px solid var(--border-color);
  color: var(--text-main);
}

.mobile-bottom-bar button,
.bottom-bar button {
  color: var(--text-main);
}

.mobile-bottom-bar button:hover,
.bottom-bar button:hover {
  color: var(--primary);
}

.kpi-card,
.layer-row,
.analysis-result,
.analysis-form input,
.analysis-form select {
  background: var(--bg-panel);
  color: var(--text-main);
  border: 1px solid var(--border-color);
}

.kpi-card h3,
.brand-subtext,
.bottom-bar,
#networkText {
  color: var(--text-muted);
}

.analysis-result strong,
.status-ok,
.status-warn,
.status-danger {
  text-shadow: none;
}

.icon-btn:focus-visible,
.menu-action:focus-visible,
.nav-btn:focus-visible,
.quick-btn:focus-visible,
.fab-button:focus-visible,
.dropdown-toggle:focus-visible,
#themeToggle:focus-visible,
#mobileMenuToggle:focus-visible {
  outline: 2px solid var(--ring-color);
  outline-offset: 2px;
}

.leaflet-container {
  filter: none;
}

.leaflet-tile {
  filter: none;
}

body.dark-theme {
  --bg-main: #080d1a;
  --bg-navbar: #0d1426;
  --bg-panel: #111a31;
  --bg-hover: #1a2442;
  --primary: #30faff;
  --secondary: #9f74ff;
  --accent: #ff3ad8;
  --text-main: #ecfbff;
  --text-muted: #a7b0c5;
  --border-color: rgba(48, 250, 255, 0.35);
  --ring-color: rgba(48, 250, 255, 0.6);
  --glow-cyan: 0 0 14px rgba(48, 250, 255, 0.82);
  --glow-magenta: 0 0 14px rgba(255, 58, 216, 0.72);
  --primary-strong: #6d40cc;
  --on-primary: #001318;
  --overlay: rgba(9, 13, 26, 0.7);
  --shadow-soft: 0 8px 20px rgba(0, 0, 0, 0.3);
  --shadow-strong: 0 16px 36px rgba(0, 0, 0, 0.46);
}

body.dark-theme {
  background: radial-gradient(circle at top right, #111827, #0b1020 70%);
}

body.dark-theme .ambient-bg {
  background:
    radial-gradient(circle at 78% 12%, rgba(0, 245, 255, 0.16), transparent 36%),
    radial-gradient(circle at 20% 82%, rgba(139, 92, 246, 0.16), transparent 36%),
    radial-gradient(circle at 50% 14%, rgba(255, 0, 200, 0.12), transparent 32%),
    var(--bg-main);
}

body.dark-theme .leaflet-container {
  filter: contrast(1.1) saturate(1.1);
}

body.dark-theme .leaflet-tile {
  filter: brightness(0.85) contrast(1.15);
}

/* Variantes optionnelles: appliquer sur <body> */
/* body class="theme-neo-low"    -> glow discret */
/* body class="theme-neo-ultra"  -> glow intense */
body.theme-neo-low {
  --border-color: rgba(0, 245, 255, 0.18);
  --glow-cyan: 0 0 7px rgba(0, 245, 255, 0.42);
  --glow-magenta: 0 0 7px rgba(255, 0, 200, 0.36);
  --glow-soft: 0 0 0 1px rgba(0, 245, 255, 0.1), 0 8px 18px rgba(0, 0, 0, 0.28);
  --glow-strong: 0 0 0 1px rgba(139, 92, 246, 0.18), 0 10px 24px rgba(0, 245, 255, 0.14);
}

body.theme-neo-ultra {
  --border-color: rgba(0, 245, 255, 0.38);
  --glow-cyan: 0 0 18px rgba(0, 245, 255, 0.92);
  --glow-magenta: 0 0 18px rgba(255, 0, 200, 0.85);
  --glow-soft: 0 0 0 1px rgba(0, 245, 255, 0.26), 0 12px 28px rgba(0, 0, 0, 0.42);
  --glow-strong: 0 0 0 1px rgba(255, 0, 200, 0.32), 0 16px 34px rgba(0, 245, 255, 0.3);
}


/* Barre rapide données: icônes seules (sans contours) */
.data-quick-bar {
  background: transparent;
  border: 0;
  box-shadow: none;
}

.data-quick-bar .quick-btn {
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  min-width: 48px;
  min-height: 48px;
  padding: 0;
  border-radius: 0;
  color: var(--text-main);
}

.data-quick-bar .quick-btn:hover,
.data-quick-bar .quick-btn:focus-visible {
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  color: var(--primary);
  outline: none;
}

/* Taille des 3 icônes rapides (plus grandes) */
.data-quick-bar .quick-btn {
  font-size: 28px;
  line-height: 1;
}

@media (max-width: 768px) {
  .data-quick-bar .quick-btn {
    font-size: 30px;
  }
}

/* Cyber Spatial Command Center: effets visuels avancés (CSS-only) */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  background-image:
    linear-gradient(rgba(0, 245, 255, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 245, 255, 0.05) 1px, transparent 1px);
  background-size: 80px 80px;
  animation: gridMove 30s linear infinite;
  z-index: 0;
}

@keyframes gridMove {
  from { background-position: 0 0; }
  to { background-position: 200px 200px; }
}

#map {
  position: relative;
}

#map::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(circle at center, rgba(0, 255, 255, 0.06) 0%, transparent 60%);
  animation: radarPulse 6s infinite linear;
  z-index: 150;
}

@keyframes radarPulse {
  0% { transform: scale(0.9); opacity: 0.4; }
  50% { transform: scale(1.05); opacity: 0.15; }
  100% { transform: scale(0.9); opacity: 0.4; }
}

.btn-primary,
.active,
.fab-button {
  animation: softPulse 2.5s ease-in-out infinite;
}

@keyframes softPulse {
  0% { box-shadow: 0 0 5px rgba(0, 255, 255, 0.4); }
  50% { box-shadow: 0 0 20px rgba(0, 255, 255, 0.8); }
  100% { box-shadow: 0 0 5px rgba(0, 255, 255, 0.4); }
}

.navbar {
  box-shadow:
    0 0 15px rgba(0, 255, 255, 0.2),
    inset 0 -1px 0 rgba(0, 255, 255, 0.2);
}

@media (max-width: 768px) {
  body::before {
    background-image:
      linear-gradient(rgba(0, 245, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 245, 255, 0.03) 1px, transparent 1px);
    background-size: 96px 96px;
    animation-duration: 42s;
  }

  #map::after {
    background: radial-gradient(circle at center, rgba(0, 255, 255, 0.04) 0%, transparent 62%);
    animation-duration: 8s;
    opacity: 0.75;
  }

  .fab-button,
  .active,
  .btn-primary {
    animation-duration: 3.2s;
  }

  .navbar {
    box-shadow:
      0 0 10px rgba(0, 255, 255, 0.14),
      inset 0 -1px 0 rgba(0, 255, 255, 0.16);
  }
}

@media (prefers-reduced-motion: reduce) {
  body::before,
  #map::after,
  .btn-primary,
  .active,
  .fab-button {
    animation: none !important;
  }
}

@media (max-width: 768px) {
  #themeToggle {
    font-size: 0;
    line-height: 0;
    width: 40px;
    min-width: 40px;
    height: 40px;
    min-height: 40px;
    border-radius: 999px;
    padding: 0;
  }

  #themeToggle::before {
    content: "\25D0";
    font-size: 20px;
    line-height: 1;
    color: var(--on-primary);
  }

  .data-quick-bar {
    background: var(--surface) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 40px !important;
    box-shadow: var(--shadow-strong) !important;
  }

  .data-quick-bar .quick-btn {
    width: 48px;
    height: 48px;
    min-width: 48px;
    min-height: 48px;
    border-radius: 50% !important;
    border: 0 !important;
    background: var(--primary) !important;
    color: var(--on-primary) !important;
    box-shadow: none !important;
    font-size: 20px !important;
  }

  .data-quick-bar .quick-btn:hover,
  .data-quick-bar .quick-btn:focus-visible {
    background: var(--primary-strong) !important;
    color: var(--on-primary) !important;
    box-shadow: none !important;
    outline: none;
  }
}

/* Ajustement final: 3 icônes bas bien alignées et lisibles */
.data-quick-bar {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 14px;
  padding: 10px 16px;
}

.data-quick-bar .quick-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  min-width: 48px;
  min-height: 48px;
  line-height: 1;
  font-size: 22px !important;
  border-radius: 50% !important;
}

@media (max-width: 768px) {
  .data-quick-bar {
    left: 50%;
    right: auto;
    transform: translateX(-50%);
    bottom: 16px;
    width: max-content;
    max-width: calc(100vw - 24px);
    gap: 12px;
    padding: 10px 14px;
    z-index: 620;
  }

  .data-quick-bar .quick-btn {
    width: 46px;
    height: 46px;
    min-width: 46px;
    min-height: 46px;
    font-size: 21px !important;
  }
}

/* Renfort mode sombre: interface plus profonde + icônes lisibles */
body.dark-theme {
  --bg-main: #010205;
  --bg-navbar: #04070f;
  --bg-panel: #070d18;
  --bg-hover: #0d1626;
  --primary: #0fd6ff;
  --secondary: #4f44ff;
  --accent: #ff1499;
  --text-main: #f2f7ff;
  --text-muted: #9ca9c2;
  --border-color: rgba(111, 235, 255, 0.18);
  --ring-color: rgba(111, 235, 255, 0.5);
  --primary-strong: #007fb8;
  --on-primary: #f3fbff;
  --overlay: rgba(1, 3, 8, 0.82);
  --shadow-soft: 0 10px 24px rgba(0, 0, 0, 0.52);
  --shadow-strong: 0 18px 40px rgba(0, 0, 0, 0.66);
}

body.dark-theme .navbar,
body.dark-theme .bottom-bar,
body.dark-theme .mobile-bottom-bar {
  background: linear-gradient(90deg, #04070f, #070d18) !important;
}

body.dark-theme .panel,
body.dark-theme .dashboard,
body.dark-theme .modal-content,
body.dark-theme .dropdown-menu,
body.dark-theme .mobile-menu,
body.dark-theme .fab-menu,
body.dark-theme .toast,
body.dark-theme .install-toast,
body.dark-theme .data-quick-bar {
  background: #070d18 !important;
  border-color: rgba(111, 235, 255, 0.2) !important;
}

body.dark-theme .panel-header {
  background: linear-gradient(90deg, #09101d, #0d1626) !important;
}

body.dark-theme .icon-btn,
body.dark-theme .menu-action,
body.dark-theme .nav-btn,
body.dark-theme .quick-btn,
body.dark-theme .fab-item {
  background: linear-gradient(135deg, #0c1527, #101b31) !important;
  color: var(--text-main) !important;
  border: 1px solid rgba(111, 235, 255, 0.17) !important;
  box-shadow: none !important;
}

body.dark-theme .icon-btn:hover,
body.dark-theme .menu-action:hover,
body.dark-theme .nav-btn:hover,
body.dark-theme .quick-btn:hover,
body.dark-theme .fab-item:hover {
  background: #16233a !important;
  color: #f5fbff !important;
}

body.dark-theme .fab-button {
  background: linear-gradient(135deg, var(--accent), var(--secondary)) !important;
  color: var(--on-primary) !important;
  border: 0 !important;
}

body.dark-theme #themeToggle::before {
  color: var(--on-primary) !important;
}

body.dark-theme .data-quick-bar .quick-btn {
  background: linear-gradient(135deg, #0d182b, #13223a) !important;
  color: #dff7ff !important;
  border: 1px solid rgba(111, 235, 255, 0.18) !important;
}

body.dark-theme .data-quick-bar .quick-btn:hover,
body.dark-theme .data-quick-bar .quick-btn:focus-visible {
  background: linear-gradient(135deg, #15243d, #193050) !important;
  color: #ffffff !important;
}

/* Visibilite icones: clair + sombre */
:root {
  --icon-foreground: #ffffff;
  --icon-shadow: none;
}

body.dark-theme {
  --icon-foreground: #f6fbff;
  --icon-shadow: 0 0 10px rgba(111, 235, 255, 0.22);
}

.nav-btn,
.menu-action,
.icon-btn,
.quick-btn,
.fab-item,
.fab-button {
  color: var(--icon-foreground) !important;
  text-shadow: var(--icon-shadow);
  font-weight: 700;
}

.nav-btn,
.menu-action,
.fab-item {
  letter-spacing: 0.01em;
}

#mobileMenuToggle,
#themeToggle,
#installButton,
.fab-button {
  opacity: 1;
}

body.dark-theme #mobileMenuToggle,
body.dark-theme #themeToggle,
body.dark-theme #installButton {
  border: 1px solid rgba(111, 235, 255, 0.28) !important;
}

body.dark-theme .dropdown-menu .menu-action,
body.dark-theme .mobile-menu .menu-action,
body.dark-theme .fab-menu .fab-item {
  color: #eaf2ff !important;
}


